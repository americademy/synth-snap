name: codeverse-synth
version: 0.0.2
architectures:
  - build-on: armhf
summary: Sound maker for the Codeverse studios
description: |
  An audio player and sound generator which exposes a web API, runs on a Codeverse module and used within the Codeverse Studios
confinement: strict
grade: stable
build-packages: [gcc]

apps:
  web-api:
    command: webserver www
    daemon: simple
    restart-condition: always
    plugs:
      - network-bind

  pulseaudio-example:
    command: bin/client-wrapper usr/bin/pulseaudio-example
    plugs:
      - pulseaudio
      - home

  gpio-control:
    command: enable-sound-card
    plugs:
      - gpio-memory-control

  chromium:
    command: usr/lib/chromium-browser/chromium-browser
    environment:
      CHROME_DESKTOP: chromium-browser.desktop
    plugs:
      - browser-support
      - desktop
      - hardware-observe
      - home
      - network
      - network-manager
      - opengl
      - password-manager-service
      - removable-media
      - screen-inhibit-control
      - wayland
      - x11-plug
    slots:
      - x11

plugs:
  x11-plug: # because cannot have identical plug/slot name in same yaml.
    interface: x11

parts:
  web-api:
    source: .
    plugin: go
    go-importpath: github.com/americademy/synth-snap

  gpio-control:
    source: .
    source-subdir: enable-sound-card
    plugin: make

  pulseaudio-example-common:
    plugin: dump
    source: overlay

  pulseaudio-example:
    plugin: cmake
    source: pulseaudio-example
    build-packages:
      - build-essential
      - libpulse-dev
      
  headless-chromium:
    source: .
    plugin: nil
    stage-packages:
      - chromium-browser
